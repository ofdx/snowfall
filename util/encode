#!/bin/bash
#
# encode
# mperron (2019)
#
# Create the assetblob file, which contains all assets. For each file in
# the assets/ directory, base64 encode the data and output C++ code to
# $OUTFILE containing that data as a string.

OUTFILE=build/assetblob

set -e
if [ -e 'assets' ] && [ -e 'build/encoder' ]; then
	cd assets

	cat > "../$OUTFILE" <<-EOF
	/*
		Auto-generated asset file.
	*/
	EOF

	i=0

	for F in $(find); do
		if [ ! -d "$F" ]; then
			fsize=$(stat -c '%s' "$F")
			cat >> "../$OUTFILE" <<-EOF
				unsigned char encdata_$i[$fsize] = {
					$(../build/encoder "$F")
				};
				FileLoader::load("${F#"./"}", new FileLoader(
					$fsize,
					encdata_$i
				));
			EOF

			i=$((i+1))
		fi
	done
fi
